<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cyberpunk2077Review-Gamiflix</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
  <link rel="stylesheet" href="/css/reviewstyle.css"/>
  <style>
    #average-pointer {
      position: absolute;
      height: 10px;
      width: 2px;
      background-color: black;
      top: -15px;
    }
    .bars {
      position: relative;
    }
  </style>
</head>

<body>
  <!-- Game Title -->
  <div class="title">Cyberpunk 2077</div>

  <!-- Description Section -->
  <div class="description-section">
    <h2 class="section-title">Description</h2>
    <p>
      Cyberpunk 2077 is an open-world, action-adventure RPG set in the sprawling megalopolis of Night City...
    </p>
  </div>

  <!-- Game Trailer and Info -->
  <div class="container">
    <iframe width="560" height="315" src="https://www.youtube.com/embed/qIcTM8WXFjk" allowfullscreen></iframe>
    <div class="game-details-container">
      <div class="game-details">
        <div class="image"><img src="/img/cyberpunkreview.jpg" /></div>
        <div class="details">
          <h1>Cyberpunk 2077</h1>
          <div class="info">
            <div><h3>Genres</h3><p>Shooter, RPG, Action</p></div>
            <div><h3>Developers</h3><p>CD Projekt RED</p></div>
            <div><h3>Release Date</h3><p>December 8, 2020</p></div>
            <div><h3>Content Rating</h3><p>Mature</p></div>
            <div><h3>Platform</h3><p>PC, PS5, Xbox Series X/S</p></div>
          </div>
          <div class="platforms">
            <i class="fab fa-steam"></i>
            <i class="fab fa-playstation"></i>
            <i class="fab fa-xbox"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gamiflix Review Table -->
  <div class="section">
    <h2 class="section-title">Gamiflix Review</h2>
    <div class="review-container">
      <table class="review-table">
        <thead>
          <tr>
            <th>Review</th><th>Liked</th><th>Disliked</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Cyberpunk 2077 is one of the most disturbing and mind-blowing RPGs in history...</td>
            <td>- Immersive experience<br>- Engaging story<br>- Detailed world</td>
            <td>- Bugs and glitches<br>- Performance issues<br>- AI limitations</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Critic Scores -->
  <div class="section"><div class="score-section"><div class="details"><div class="label">Gamiflix Score</div><div class="description">Generally Favorable</div><div class="reviews">Based on 50 Critic Reviews</div></div><div class="score gamiflix-green">84</div></div><div class="progress-bar-green"></div></div>
  <div class="section"><div class="score-section"><div class="details"><div class="label">Graphics Score</div><div class="description">Exceptional</div><div class="reviews">Based on 35 Critic Ratings</div></div><div class="score graphics-green">94</div></div><div class="progress-bar-green"></div></div>
  <div class="section"><div class="score-section"><div class="details"><div class="label">Gameplay Score</div><div class="description">Exceptional</div><div class="reviews">Based on 45 Critic Ratings</div></div><div class="score gameplay-green">90</div></div><div class="progress-bar-green"></div></div>
  <div class="section"><div class="score-section"><div class="details"><div class="label">Smoothness Score</div><div class="description">Generally Favorable</div><div class="reviews">Based on 30 Critic Ratings</div></div><div class="score smoothness-green">74</div></div><div class="progress-bar-green"></div></div>

  <!-- My Score Interactive Section -->
  <div class="section my-score">
    <div class="rating">
      <div class="details"><div class="label">My Score</div><div class="description">Give your rating of the game</div></div>
      <div class="bars">
        <div class="bar" data-value="10"></div>
        <div class="bar" data-value="20"></div>
        <div class="bar" data-value="30"></div>
        <div class="bar" data-value="40"></div>
        <div class="bar" data-value="50"></div>
        <div class="bar" data-value="60"></div>
        <div class="bar" data-value="70"></div>
        <div class="bar" data-value="80"></div>
        <div class="bar" data-value="90"></div>
        <div class="bar" data-value="100"></div>
        <div class="average-pointer" id="average-pointer"></div>
      </div>
      <div class="circle" id="my-score-circle">0</div>
    </div>
  </div>

  <!-- Review Form -->
  <div class="section">
    <button id="add-review-button">Add My Review</button>
    <div id="review-form" style="display: none;">
      <input type="text" id="reviewerName" placeholder="Your Name" required />
      <textarea id="reviewText" placeholder="Write Your Review Here....." required></textarea>
      <button id="submit-review">Submit Review</button>
    </div>
    <h2 class="section-title">User Reviews</h2>
    <div id="reviewsDisplay"></div>
  </div>

  <!-- Rating Logic -->
  <script>
    document.querySelectorAll('.bar').forEach(bar => {
      bar.addEventListener('mouseover', function () {
        const value = this.getAttribute('data-value');
        document.getElementById('my-score-circle').textContent = value;
      });

      bar.addEventListener('click', function () {
        const value = parseInt(this.getAttribute('data-value'));
        saveRating(value); // Save to Firebase
      });
    });

    function updateAverageScoreColor(average) {
      const circle = document.getElementById('my-score-circle');
      if (average < 40) {
        circle.style.backgroundColor = '#ff6666';
      } else if (average < 70) {
        circle.style.backgroundColor = '#ffcc66';
      } else {
        circle.style.backgroundColor = '#66cc66';
      }
    }

    function updateAveragePointer(average) {
      const pointer = document.getElementById('average-pointer');
      const barsContainer = document.querySelector('.bars');
      const containerWidth = barsContainer.offsetWidth;
      pointer.style.left = `${(average / 100) * containerWidth}px`;
    }
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import {
    getFirestore,
    collection,
    doc,
    setDoc,
    getDocs,
    getDoc,
    query,
    orderBy,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
  import {
    getAuth,
    signInAnonymously,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";

 const firebaseConfig = {
  apiKey: "AIzaSyD0r-_MOrfc6eDdIBCKSrzWPmtCh-wSwBA",
  authDomain: "gamiflix-b5dd4.firebaseapp.com",
  projectId: "gamiflix-b5dd4",
  storageBucket: "gamiflix-b5dd4.firebasestorage.app",
  messagingSenderId: "788038216303",
  appId: "1:788038216303:web:c9eb3c6afae9b72ee27b9a",
  measurementId: "G-DR3BDWLQ3P"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth();

  signInAnonymously(auth).catch(error => console.error("Auth error:", error));

  // Wait for authentication
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const uid = user.uid;
      const gameId = "cyberpunk2077";
      const ratingsRef = collection(db, "ratings", gameId, "userRatings");

      document.querySelectorAll('.bar').forEach(bar => {
        bar.addEventListener('click', async function () {
          const value = parseInt(this.getAttribute('data-value'));

          // Save user rating
          const userRatingRef = doc(ratingsRef, uid);
          await setDoc(userRatingRef, { rating: value });

          // Fetch and calculate average
          const snapshot = await getDocs(ratingsRef);
          let total = 0;
          let count = 0;
          snapshot.forEach(doc => {
            const data = doc.data();
            if (data.rating !== undefined) {
              total += data.rating;
              count++;
            }
          });

          const average = total / count;
          document.getElementById('my-score-circle').textContent = average.toFixed(1);
          updateAverageScoreColor(average);
          updateAveragePointer(average);
        });
      });

      // Fetch average score on load
      window.addEventListener("load", async () => {
        const snapshot = await getDocs(ratingsRef);
        let total = 0;
        let count = 0;
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.rating !== undefined) {
            total += data.rating;
            count++;
          }
        });
        if (count > 0) {
          const average = total / count;
          document.getElementById('my-score-circle').textContent = average.toFixed(1);
          updateAverageScoreColor(average);
          updateAveragePointer(average);
        }
      });
    }
  });

  // Display User Reviews
  async function displayReviews() {
    const reviewsDisplay = document.getElementById('reviewsDisplay');
    reviewsDisplay.innerHTML = '';
    const reviewsQuery = query(collection(db, 'reviews'), orderBy('timestamp', 'desc'));
    const querySnapshot = await getDocs(reviewsQuery);
    querySnapshot.forEach((doc) => {
      const r = doc.data();
      const div = document.createElement('div');
      div.classList.add('review-item');
      div.innerHTML = `<strong>${r.name}</strong><p>${r.review}</p><small>${new Date(r.timestamp?.toDate()).toLocaleString()}</small>`;
      reviewsDisplay.appendChild(div);
    });
  }

  document.getElementById('add-review-button').addEventListener('click', (e) => {
    e.preventDefault();
    const form = document.getElementById('review-form');
    form.style.display = (form.style.display === 'block') ? 'none' : 'block';
  });

  document.getElementById('submit-review').addEventListener('click', async () => {
    const name = document.getElementById('reviewerName').value;
    const review = document.getElementById('reviewText').value;
    if (name && review) {
      try {
        await setDoc(doc(collection(db, 'reviews')), {
          name,
          review,
          timestamp: serverTimestamp()
        });
        document.getElementById('reviewerName').value = '';
        document.getElementById('reviewText').value = '';
        displayReviews();
        alert('Thank you for your review!');
      } catch (err) {
        console.error('Error:', err);
      }
    } else {
      alert('Please fill in all fields.');
    }
  });

  window.onload = displayReviews;
</script>

</body>
</html>
